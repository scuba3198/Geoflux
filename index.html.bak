<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoFlux - Generative Art Sandbox</title>

    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        canvas {
            display: block;
        }

        .glass-panel {
            background: rgba(10, 10, 10, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Custom Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #fff;
            margin-top: -6px;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- Icons as Components (SVG) ---
        const IconSettings = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" /><circle cx="12" cy="12" r="3" /></svg>;
        const IconDownload = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" y1="15" x2="12" y2="3" /></svg>;
        const IconRefresh = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16" /><path d="M16 21h5v-5" /></svg>;
        const IconX = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18" /><path d="m6 6 12 12" /></svg>;

        // --- Particle Class ---
        class Particle {
            constructor(w, h, id) {
                this.id = id;
                this.reset(w, h, true);
            }

            reset(w, h, randomY = false) {
                this.x = Math.random() * w;
                this.y = randomY ? Math.random() * h : -20;

                // Base velocity vector
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 0.5 + 0.2;
                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed;

                this.size = Math.random() * 2 + 1;
                // Unique phase for oscillation
                this.phase = Math.random() * Math.PI * 2;
            }

            update(w, h, params, time) {
                // Apply Gravity (vertical force)
                // If gravity is 0, it behaves like floating dust. If > 0, it falls.
                const gravityForce = (params.gravity / 50) * 0.2;

                this.vy += gravityForce;

                // Apply Speed Multiplier
                // We normalize velocity then apply speed to prevent runaway acceleration from gravity
                let currentSpeedX = this.vx * (params.speed / 50);
                let currentSpeedY = this.vy * (params.speed / 50);

                // Add some "noise" or wiggle based on time
                const wiggle = Math.sin(time * 0.002 + this.phase) * (params.speed / 100);
                this.x += currentSpeedX + wiggle;
                this.y += currentSpeedY;

                // Boundary Checks
                if (this.x < 0 || this.x > w || this.y > h + 20) {
                    // Wrap around or reset
                    if (params.gravity > 10) {
                        // If falling, reset to top
                        if (this.y > h) this.reset(w, h, false);
                        if (this.x < 0) this.x = w;
                        if (this.x > w) this.x = 0;
                    } else {
                        // If floating, bounce or wrap
                        if (this.x < 0) this.x = w;
                        else if (this.x > w) this.x = 0;
                        if (this.y < 0) this.y = h;
                        else if (this.y > h) this.y = 0;
                    }
                }
            }
        }

        const App = () => {
            const canvasRef = useRef(null);
            const [particles, setParticles] = useState([]);
            const [showControls, setShowControls] = useState(true);
            const [params, setParams] = useState({
                speed: 50,      // 0 - 100
                gravity: 0,     // 0 - 100
                density: 50,    // 10 - 200 (number of particles)
                colorSpeed: 20, // 0 - 100 (hue cycle speed)
                range: 40,      // 20 - 150 (connection distance)
                baseHue: 180,   // 0 - 360
            });
            const [dims, setDims] = useState({ w: window.innerWidth, h: window.innerHeight });

            // Initialize Particles
            useEffect(() => {
                const count = Math.floor((params.density / 100) * 150) + 20;
                // Create new particle array
                const newParticles = [];
                for (let i = 0; i < count; i++) {
                    newParticles.push(new Particle(dims.w, dims.h, i));
                }
                setParticles(newParticles);
            }, [params.density, dims]); // Re-init when density or screen size changes

            // Handle Resize
            useEffect(() => {
                const handleResize = () => {
                    setDims({ w: window.innerWidth, h: window.innerHeight });
                    if (canvasRef.current) {
                        canvasRef.current.width = window.innerWidth;
                        canvasRef.current.height = window.innerHeight;
                    }
                };
                window.addEventListener('resize', handleResize);
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            // Main Animation Loop
            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                let animationFrameId;
                let time = 0;

                const render = () => {
                    time += 1;
                    const { w, h } = dims;

                    ctx.fillStyle = 'rgba(0, 0, 0, 0.2)'; // Adjust alpha for trail length
                    ctx.fillRect(0, 0, w, h);

                    // Calculate Global Color
                    // Slowly rotate hue based on time and param
                    const hueShift = (time * (params.colorSpeed / 50)) + params.baseHue;

                    // Update and Draw Particles
                    particles.forEach(p => {
                        p.update(w, h, params, time);

                        // Draw Point
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                        ctx.fillStyle = `hsl(${hueShift + p.x * 0.1}, 70%, 60%)`;
                        ctx.fill();
                    });

                    // Draw Connections (Plexus Effect)

                    const connectDistance = params.range * 3; // Scale range up for pixels

                    ctx.lineWidth = 0.5;

                    for (let i = 0; i < particles.length; i++) {
                        for (let j = i + 1; j < particles.length; j++) {
                            const p1 = particles[i];
                            const p2 = particles[j];

                            const dx = p1.x - p2.x;
                            const dy = p1.y - p2.y;
                            const dist = Math.sqrt(dx * dx + dy * dy);

                            if (dist < connectDistance) {
                                // Calculate opacity based on distance
                                const opacity = 1 - (dist / connectDistance);

                                ctx.beginPath();
                                ctx.strokeStyle = `hsla(${hueShift}, 80%, 50%, ${opacity})`;
                                ctx.moveTo(p1.x, p1.y);
                                ctx.lineTo(p2.x, p2.y);
                                ctx.stroke();
                            }
                        }
                    }

                    animationFrameId = requestAnimationFrame(render);
                };

                render();

                return () => cancelAnimationFrame(animationFrameId);
            }, [particles, params, dims]);

            // Handlers
            const handleParamChange = (key, value) => {
                setParams(prev => ({ ...prev, [key]: parseFloat(value) }));
            };

            const downloadWallpaper = () => {
                const canvas = canvasRef.current;
                // Create a temporary link
                const link = document.createElement('a');
                // High quality output
                link.download = `geoflux-art-${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png', 1.0);
                link.click();
            };

            const toggleControls = () => setShowControls(!showControls);

            return (
                <div className="relative w-full h-screen overflow-hidden bg-black">
                    {/* The Canvas */}
                    <canvas
                        ref={canvasRef}
                        width={dims.w}
                        height={dims.h}
                        className="absolute top-0 left-0 w-full h-full"
                    />

                    {/* Header / Brand */}
                    <div className="absolute top-6 left-6 pointer-events-none select-none z-10">
                        <h1 className="text-3xl font-bold tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-500 opacity-80">
                            GEOFLUX
                        </h1>
                        <p className="text-xs text-gray-400 tracking-widest uppercase mt-1">Generative Sandbox</p>
                    </div>

                    {/* Credit - Subtle watermark in bottom left */}
                    <div className="absolute bottom-6 left-6 pointer-events-none select-none z-10">
                        <p className="text-[10px] text-white/80 tracking-[0.2em] font-medium uppercase drop-shadow-md">
                            by Mumukshu D.C
                        </p>
                    </div>

                    {/* Toggle Button (Visible when controls hidden) */}
                    {!showControls && (
                        <button
                            onClick={toggleControls}
                            className="absolute bottom-6 right-6 p-3 rounded-full glass-panel hover:bg-white/10 transition-all z-20 text-white"
                        >
                            <IconSettings />
                        </button>
                    )}

                    {/* Control Panel */}
                    <div className={`absolute top-0 right-0 h-full w-80 glass-panel p-6 transform transition-transform duration-300 ease-in-out z-20 flex flex-col ${showControls ? 'translate-x-0' : 'translate-x-full'}`}>

                        <div className="flex justify-between items-center mb-8">
                            <h2 className="text-lg font-semibold text-white flex items-center gap-2">
                                <IconSettings /> Parameters
                            </h2>
                            <button onClick={toggleControls} className="text-gray-400 hover:text-white transition-colors">
                                <IconX />
                            </button>
                        </div>

                        <div className="flex-1 overflow-y-auto hide-scrollbar space-y-8 pr-2">

                            {/* Sliders */}
                            <div className="space-y-4">
                                <div className="space-y-2">
                                    <div className="flex justify-between text-sm">
                                        <label className="text-cyan-300">Density</label>
                                        <span className="text-gray-400">{params.density}%</span>
                                    </div>
                                    <input
                                        type="range" min="10" max="150" step="1"
                                        value={params.density}
                                        onChange={(e) => handleParamChange('density', e.target.value)}
                                    />
                                    <p className="text-xs text-gray-500">Number of geometric nodes.</p>
                                </div>

                                <div className="space-y-2">
                                    <div className="flex justify-between text-sm">
                                        <label className="text-purple-300">Flow Speed</label>
                                        <span className="text-gray-400">{params.speed}%</span>
                                    </div>
                                    <input
                                        type="range" min="0" max="100" step="1"
                                        value={params.speed}
                                        onChange={(e) => handleParamChange('speed', e.target.value)}
                                    />
                                </div>

                                <div className="space-y-2">
                                    <div className="flex justify-between text-sm">
                                        <label className="text-green-300">Gravity</label>
                                        <span className="text-gray-400">{params.gravity > 10 ? 'Falling' : 'Floating'}</span>
                                    </div>
                                    <input
                                        type="range" min="0" max="100" step="1"
                                        value={params.gravity}
                                        onChange={(e) => handleParamChange('gravity', e.target.value)}
                                    />
                                </div>

                                <div className="space-y-2">
                                    <div className="flex justify-between text-sm">
                                        <label className="text-pink-300">Color Cycle</label>
                                        <span className="text-gray-400">{params.colorSpeed}hz</span>
                                    </div>
                                    <input
                                        type="range" min="0" max="100" step="1"
                                        value={params.colorSpeed}
                                        onChange={(e) => handleParamChange('colorSpeed', e.target.value)}
                                    />
                                </div>

                                <div className="space-y-2">
                                    <div className="flex justify-between text-sm">
                                        <label className="text-yellow-300">Base Hue</label>
                                        <div
                                            className="w-4 h-4 rounded-full"
                                            style={{ backgroundColor: `hsl(${params.baseHue}, 70%, 50%)` }}
                                        ></div>
                                    </div>
                                    <input
                                        type="range" min="0" max="360" step="1"
                                        value={params.baseHue}
                                        onChange={(e) => handleParamChange('baseHue', e.target.value)}
                                        className="hue-slider"
                                    />
                                    <style jsx>{`
                                        .hue-slider::-webkit-slider-runnable-track {
                                            background: linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet, red);
                                        }
                                    `}</style>
                                </div>

                                <div className="space-y-2">
                                    <div className="flex justify-between text-sm">
                                        <label className="text-blue-300">Link Range</label>
                                        <span className="text-gray-400">{params.range}px</span>
                                    </div>
                                    <input
                                        type="range" min="20" max="100" step="1"
                                        value={params.range}
                                        onChange={(e) => handleParamChange('range', e.target.value)}
                                    />
                                </div>
                            </div>

                        </div>

                        {/* Footer / Actions */}
                        <div className="mt-6 pt-6 border-t border-white/10 space-y-3">
                            <button
                                onClick={downloadWallpaper}
                                className="w-full flex items-center justify-center gap-2 bg-white/10 hover:bg-white/20 active:bg-white/30 text-white py-3 rounded-lg font-medium transition-all"
                            >
                                <IconDownload size={18} /> Download Wallpaper
                            </button>

                            <p className="text-center text-xs text-gray-500 mt-4">
                                Tap 'Download' to save the current frame.
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>